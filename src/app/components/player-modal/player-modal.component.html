<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="cancel()" fill="clear">
        <ion-icon slot="icon-only" name="chevron-down-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>
<ion-content [fullscreen]="true" class="ion-padding" scrollY="false">
  <div class="background">
    <img
      [src]="player.currentEpisode().image_url"
      [alt]="player.currentEpisode().title"
    />
    <div class="overlay"></div>
  </div>

  @if (showPauseOverlay && !isTouchedMove) {
    <div class="pause-overlay" (touchend)="isTouchDevice ? onPlay($event) : null"
         (mouseup)="!isTouchDevice ? onPlay($event) : null">
      <ion-icon name="play-circle"></ion-icon>
    </div>
  }

  <div class="modal-content" (touchend)="isTouchDevice ? onPause($event) : null"
       (mouseup)="!isTouchDevice ? onPause($event) : null"
       (touchmove)="isTouchDevice ? onTouchMove($event) : null"
       (mousedown)="!isTouchDevice ? mouseDown() : null"
       (mousemove)="!isTouchDevice ? onTouchMove($event) : null">
    <div class="title backdrop">
      <h2 class="">{{ player.currentEpisode().title }}</h2>
      <h3 class="">{{ player.currentEpisode().host_name }}</h3>
    </div>

    <app-player-waveform></app-player-waveform>

    <div class="times">
      <div class="top">
        <span class="backdrop">{{ player.currentTime | timeline }}</span>

        <span class="line"></span>

        <span class="backdrop">
          {{ player.totalDuration - player.currentTime | timeline }}</span
        >
      </div>

      <span class="backdrop"> {{ player.totalDuration | timeline }}</span>
    </div>
  </div>
</ion-content>

<ion-footer [class.visible]="!showPauseOverlay">
  <ion-toolbar>
    <ion-buttons slot="secondary">
      <ion-button class="tool" (click)="onEpisodeDetail()">
        Episode Info
      </ion-button>
    </ion-buttons>

    <ion-buttons slot="primary">
      <div class="tools">
        <div class="tool">
          <ion-select
            interface="popover"
            [(ngModel)]="selectedSpeed"
            (ngModelChange)="onSpeedChange($event)"
          >
            @for (item of speedOptions; track $index) {
              <ion-select-option [value]="item">{{ item }}X</ion-select-option>
            }
          </ion-select>
        </div>

        <div class="tool">
          <ion-icon
            slot="icon-only"
            name="share-social-outline"
            (click)="onShare()"
          ></ion-icon>
        </div>
      </div>
    </ion-buttons>
  </ion-toolbar>

  <app-player-timeline></app-player-timeline>
</ion-footer>
